---
import AppJsonLd from "@/components/AppJsonLd.astro";
import BaseLayout from "@/layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

export async function getStaticPaths() {
	const apps = await getCollection("apps");
	return apps.map((app) => ({
		params: { slug: app.slug },
		props: { app },
	}));
}

const { app } = Astro.props;
const { Content } = await app.render(); // ✅ compile MD to a component
const title = `${app.data.title} — FusionCore Apps`;
const description = app.data.description;
const canonical = new URL(`/apps/${app.slug}`, Astro.site).href;
---

<BaseLayout {canonical} {description} {title}>
	<AppJsonLd app={app} />

	<article class="grid gap-8 lg:grid-cols-[auto,1fr]">
		<img
			alt={app.data.title}
			class="h-24 w-24 rounded-2xl"
			src={app.data.icon ?? "/placeholder-app.svg"}
		/>
		<div>
			<h1 class="text-3xl font-bold">{app.data.title}</h1>
			<p class="mt-2 text-gray-700">{app.data.tagline}</p>
			<div class="mt-4 flex items-center gap-3">
				<a
					aria-label="Get it on Google Play"
					class="inline-flex"
					href={app.data.playUrl}
					rel="noopener nofollow sponsored"
					target="_blank"
				>
					<img
						alt="Get it on Google Play"
						class="h-14 w-auto select-none"
						decoding="async"
						fetchpriority="high"
						height="80"
						loading="eager"
						src="/GetItOnGooglePlay_Badge_Web_color_English.png"
						width="270"
					/>
				</a>

				<a class="rounded-xl border px-5 py-3 font-medium hover:bg-gray-50" href="/apps">
					Back to apps
				</a>
			</div>
		</div>
	</article>

	<section class="mt-10">
		<div class="card p-8">
			<h2 class="mb-4 text-2xl font-semibold">About this app</h2>
			<div
				class="prose prose-lg dark:prose-invert prose-a:text-brand-600 hover:prose-a:text-brand-700 max-w-none"
			>
				<Content />
				<!-- ✅ styled Markdown -->
			</div>
		</div>
	</section>

	{
		app.data.screenshots?.length ? (
			<section class="mt-10">
				<h2 class="mb-4 text-2xl font-semibold">Screenshots</h2>
				<div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
					{app.data.screenshots.map((src) => (
						<img alt={app.data.title} class="rounded-xl border" loading="lazy" src={src} />
					))}
				</div>
			</section>
		) : null
	}
</BaseLayout>
