---
import ThemeToggle from '../components/ThemeToggle';

const { 
  title = 'FusionCore Apps â€” Premium Mobile Applications', 
  description = 'Professional mobile app development studio delivering secure, innovative, and user-friendly applications for Android and iOS platforms. Transform your ideas into powerful digital experiences.',
  ogImage = '/og-default.jpg',
  canonical,
  noindex = false,
  bodyClass = '',
  showHero = false
} = Astro.props;

const year = new Date().getFullYear();
const currentPath = Astro.url.pathname;
---

<!doctype html>
<html lang="en" class="scroll-smooth">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <title>{title}</title>
    <meta name="description" content={description} />
    <meta name="robots" content={noindex ? 'noindex,nofollow' : 'index,follow'} />
    <link rel="canonical" href={canonical ?? new URL(Astro.url.pathname, Astro.site).href} />
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content={new URL(Astro.url.pathname, Astro.site).href} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={new URL(ogImage, Astro.site).href} />
    <meta property="og:site_name" content="FusionCore Apps" />
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content={new URL(Astro.url.pathname, Astro.site).href} />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={new URL(ogImage, Astro.site).href} />
    
    <!-- Theme and appearance -->
    <meta name="theme-color" content="#3d6a45" />
    <meta name="color-scheme" content="light dark" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/logo.svg" />
    <link rel="apple-touch-icon" href="/logo.svg" />
    
    <!-- Preconnect to external domains -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    
    <!-- JSON-LD structured data -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "Organization",
        "name": "FusionCore Apps",
        "description": "Professional mobile app development studio",
        "url": "https://fusioncore.app",
        "logo": "https://fusioncore.app/logo.svg",
        "foundingDate": "2024",
        "sameAs": [
          "https://play.google.com/store/apps/developer?id=FusionCore+Apps"
        ]
      }
    </script>
    
    <!-- Theme initialization script (blocking to prevent FOUC) -->
    <script is:inline>
      (function() {
        const stored = localStorage.getItem('theme');
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        const isDark = stored === 'dark' || (!stored && prefersDark);
        
        if (isDark) {
          document.documentElement.classList.add('dark');
        }
      })();
    </script>
  </head>
  
  <body class={`min-h-screen antialiased ${bodyClass}`}>
    <!-- Skip to content link for accessibility -->
    <a 
      href="#main" 
      class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-50 button button--primary"
    >
      Skip to main content
    </a>
    
    <!-- Header -->
    <header class="header sticky top-0 z-40 border-b border-gray-200/50 dark:border-gray-800/50 bg-white/80 dark:bg-gray-950/80 backdrop-blur-lg">
      <nav class="header__nav container flex items-center justify-between py-4" role="navigation" aria-label="Main navigation">
        <!-- Logo -->
        <a href="/" class="header__logo flex items-center gap-3 font-bold text-xl text-gray-900 dark:text-white hover:text-brand-600 dark:hover:text-brand-400 transition-colors group">
          <div class="w-10 h-10 bg-gradient-to-br from-brand-500 to-brand-600 rounded-xl flex items-center justify-center shadow-lg group-hover:shadow-xl group-hover:scale-105 transition-all duration-200">
            <img src="/logo.svg" alt="FusionCore Apps" class="w-6 h-6 brightness-0 invert" />
          </div>
          <span class="gradient-text">FusionCore</span>
        </a>
        
        <!-- Desktop Navigation -->
        <ul class="header__nav-links hidden md:flex items-center gap-8" role="menubar">
          <li role="none">
            <a 
              href="/apps" 
              class={`nav-link ${currentPath.startsWith('/apps') ? 'nav-link--active' : ''}`}
              role="menuitem"
            >
              Apps
            </a>
          </li>
          <li role="none">
            <a 
              href="/privacy" 
              class={`nav-link ${currentPath === '/privacy' ? 'nav-link--active' : ''}`}
              role="menuitem"
            >
              Privacy
            </a>
          </li>
          <li role="none">
            <a 
              href="/contact" 
              class={`nav-link ${currentPath === '/contact' ? 'nav-link--active' : ''}`}
              role="menuitem"
            >
              Contact
            </a>
          </li>
          <li role="none">
            <a 
              href="/admin" 
              class={`nav-link ${currentPath.startsWith('/admin') ? 'nav-link--active' : ''}`}
              role="menuitem"
            >
              Admin
            </a>
          </li>
        </ul>
        
        <!-- Theme Toggle & Mobile Menu -->
        <div class="header__actions flex items-center gap-3">
          <ThemeToggle client:load />
          
          <!-- Mobile menu button -->
          <button 
            class="md:hidden inline-flex items-center justify-center w-10 h-10 rounded-xl bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400 hover:text-brand-600 dark:hover:text-brand-400 hover:bg-gray-200 dark:hover:bg-gray-700 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-brand-500"
            aria-label="Open mobile menu"
            id="mobile-menu-button"
          >
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
            </svg>
          </button>
        </div>
      </nav>
      
      <!-- Mobile Navigation Menu -->
      <div class="header__mobile-menu md:hidden hidden border-t border-gray-200 dark:border-gray-800" id="mobile-menu">
        <nav class="container py-4" role="navigation" aria-label="Mobile navigation">
          <ul class="space-y-4" role="menubar">
            <li role="none">
              <a 
                href="/apps" 
                class={`block px-4 py-2 rounded-xl text-gray-900 dark:text-gray-100 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors ${currentPath.startsWith('/apps') ? 'bg-brand-50 dark:bg-brand-900/20 text-brand-600 dark:text-brand-400' : ''}`}
                role="menuitem"
              >
                Apps
              </a>
            </li>
            <li role="none">
              <a 
                href="/privacy" 
                class={`block px-4 py-2 rounded-xl text-gray-900 dark:text-gray-100 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors ${currentPath === '/privacy' ? 'bg-brand-50 dark:bg-brand-900/20 text-brand-600 dark:text-brand-400' : ''}`}
                role="menuitem"
              >
                Privacy
              </a>
            </li>
            <li role="none">
              <a 
                href="/contact" 
                class={`block px-4 py-2 rounded-xl text-gray-900 dark:text-gray-100 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors ${currentPath === '/contact' ? 'bg-brand-50 dark:bg-brand-900/20 text-brand-600 dark:text-brand-400' : ''}`}
                role="menuitem"
              >
                Contact
              </a>
            </li>
            <li role="none">
              <a 
                href="/admin" 
                class={`block px-4 py-2 rounded-xl text-gray-900 dark:text-gray-100 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors ${currentPath.startsWith('/admin') ? 'bg-brand-50 dark:bg-brand-900/20 text-brand-600 dark:text-brand-400' : ''}`}
                role="menuitem"
              >
                Admin Panel
              </a>
            </li>
          </ul>
        </nav>
      </div>
    </header>
    
    <!-- Main Content -->
    <main id="main" class="main flex-1" role="main">
      {showHero && (
        <section class="hero gradient-bg py-24 sm:py-32">
          <div class="container">
            <slot name="hero" />
          </div>
        </section>
      )}
      
      <div class={showHero ? 'py-16 sm:py-24' : 'py-8 sm:py-12'}>
        <div class="container">
          <slot />
        </div>
      </div>
    </main>
    
    <!-- Footer -->
    <footer class="footer border-t border-gray-200 dark:border-gray-800 bg-gray-50 dark:bg-gray-900/50" role="contentinfo">
      <div class="container">
        <!-- Main footer content -->
        <div class="footer__content py-12 grid gap-8 md:grid-cols-4">
          <!-- Company info -->
          <div class="footer__section md:col-span-2">
            <a href="/" class="footer__logo flex items-center gap-3 mb-4">
              <div class="w-8 h-8 bg-gradient-to-br from-brand-500 to-brand-600 rounded-lg flex items-center justify-center">
                <img src="/logo.svg" alt="FusionCore Apps" class="w-5 h-5 brightness-0 invert" />
              </div>
              <span class="font-bold text-lg text-gray-900 dark:text-white">FusionCore Apps</span>
            </a>
            <p class="footer__description text-gray-600 dark:text-gray-400 mb-6 max-w-md">
              Professional mobile app development studio delivering secure, innovative, and user-friendly applications. Transform your ideas into powerful digital experiences.
            </p>
            <div class="footer__social flex items-center gap-4">
              <a 
                href="https://play.google.com/store/apps/developer?id=FusionCore+Apps" 
                class="text-gray-400 hover:text-brand-600 dark:hover:text-brand-400 transition-colors"
                aria-label="Visit our Google Play Store"
                target="_blank"
                rel="noopener noreferrer"
              >
                <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M3,20.5V3.5C3,2.91 3.34,2.39 3.84,2.15L13.69,12L3.84,21.85C3.34,21.6 3,21.09 3,20.5M16.81,15.12L6.05,21.34L14.54,12.85L16.81,15.12M20.16,10.81C20.5,11.08 20.75,11.5 20.75,12C20.75,12.5 20.53,12.9 20.18,13.18L17.89,14.5L15.39,12L17.89,9.5L20.16,10.81M6.05,2.66L16.81,8.88L14.54,11.15L6.05,2.66Z"/>
                </svg>
              </a>
            </div>
          </div>
          
          <!-- Quick links -->
          <div class="footer__section">
            <h3 class="footer__title font-semibold text-gray-900 dark:text-white mb-4">Quick Links</h3>
            <ul class="footer__links space-y-3">
              <li><a href="/apps" class="text-gray-600 dark:text-gray-400 hover:text-brand-600 dark:hover:text-brand-400 transition-colors">All Apps</a></li>
              <li><a href="/privacy" class="text-gray-600 dark:text-gray-400 hover:text-brand-600 dark:hover:text-brand-400 transition-colors">Privacy Policy</a></li>
              <li><a href="/contact" class="text-gray-600 dark:text-gray-400 hover:text-brand-600 dark:hover:text-brand-400 transition-colors">Contact Us</a></li>
            </ul>
          </div>
          
          <!-- Support -->
          <div class="footer__section">
            <h3 class="footer__title font-semibold text-gray-900 dark:text-white mb-4">Support</h3>
            <ul class="footer__links space-y-3">
              <li><a href="/contact" class="text-gray-600 dark:text-gray-400 hover:text-brand-600 dark:hover:text-brand-400 transition-colors">Help Center</a></li>
              <li><a href="/contact" class="text-gray-600 dark:text-gray-400 hover:text-brand-600 dark:hover:text-brand-400 transition-colors">Report Bug</a></li>
              <li><a href="/contact" class="text-gray-600 dark:text-gray-400 hover:text-brand-600 dark:hover:text-brand-400 transition-colors">Feature Request</a></li>
            </ul>
          </div>
        </div>
        
        <!-- Footer bottom -->
        <div class="footer__bottom border-t border-gray-200 dark:border-gray-700 py-6 flex flex-col sm:flex-row items-center justify-between gap-4">
          <p class="text-sm text-gray-600 dark:text-gray-400">
            &copy; {year} FusionCore Apps. All rights reserved.
          </p>
          <div class="flex items-center gap-6 text-sm text-gray-600 dark:text-gray-400">
            <a href="/privacy" class="hover:text-brand-600 dark:hover:text-brand-400 transition-colors">Privacy</a>
            <a href="/contact" class="hover:text-brand-600 dark:hover:text-brand-400 transition-colors">Terms</a>
          </div>
        </div>
      </div>
    </footer>
    
    <!-- Mobile menu toggle script -->
    <script is:inline>
      document.addEventListener('DOMContentLoaded', function() {
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');
        
        if (mobileMenuButton && mobileMenu) {
          mobileMenuButton.addEventListener('click', function() {
            mobileMenu.classList.toggle('hidden');
            const isExpanded = !mobileMenu.classList.contains('hidden');
            mobileMenuButton.setAttribute('aria-expanded', isExpanded.toString());
          });
        }
      });
    </script>
  </body>
</html>
